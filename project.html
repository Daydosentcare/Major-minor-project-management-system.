<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEC Project Management System</title>
    
    <!-- Google Fonts: Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS VARIABLES & THEME --- */
        :root {
            /* Light Mode (Default) */
            --primary: #0D3B66; 
            --secondary: #FAF0CA;
            --accent: #F09410;
            --text-main: #0D3B66;
            --text-inv: #FAF0CA;
            --bg-body: #FAF0CA;
            --bg-card: #ffffff;
            --border-color: #0D3B66;
            --shadow: 0 4px 6px rgba(13, 59, 102, 0.1);
            --header-bg: #0D3B66;
            --input-bg: #ffffff;
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --bg-body: #0F1216; 
            --bg-card: #162029; 
            --text-main: #e2e8f0;       
            --primary: #0D3B66;         
            --header-bg: #0D3B66;       
            --accent: #F09410;          
            --border-color: #0D3B66;    
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            --text-inv: #000000;
            --input-bg: #0a0c10;
        }

        /* --- GLOBAL STYLES --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Base Button Style */
        .btn {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            background-color: transparent;
            color: var(--text-main);
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            background-color: var(--accent);
            color: #000; /* Always black on orange hover */
            border-color: var(--accent);
        }

        /* Primary Button */
        .btn-primary {
            background-color: var(--primary); 
            color: #fff; 
            border: 2px solid var(--primary);
        }
        
        [data-theme="dark"] .btn-primary {
            background-color: var(--accent);
            border-color: var(--accent);
            color: #000;
        }

        [data-theme="dark"] .btn-primary:hover {
            background-color: #d17f0a; 
            border-color: #d17f0a;
            color: #ffffff;
        }
        
        /* --- HEADER --- */
        header {
            background-color: var(--header-bg);
            color: var(--secondary);
            padding: 10px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--accent);
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .logo-img {
            height: 60px; 
            width: auto;
            background: white; /* White bg for logo visibility on dark/blue */
            border-radius: 4px;
            padding: 2px;
        }
        .header-title {
            text-align: center;
            flex-grow: 1;
        }
        .header-title h1 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
        }
        .header-title span {
            font-size: 0.8rem;
            text-transform: uppercase;
            opacity: 0.9;
            color: var(--accent);
        }
        
        .theme-toggle {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .theme-toggle:hover {
            background: var(--accent);
            color: #000;
        }

        /* --- VIEWS --- */
        .view-section {
            animation: fadeIn 0.4s ease-in-out;
            margin-top: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- LANDING PAGE --- */
        #landing-view {
            text-align: center;
            padding-top: 40px;
        }
        .role-cards {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 50px;
        }
        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 30px;
            border-radius: 12px;
            width: 280px;
            cursor: pointer;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(240, 148, 16, 0.4); 
        }
        .card h3 { font-size: 1.4rem; margin-bottom: 5px; }
        .card p { font-size: 0.9rem; opacity: 0.8; }
        .card-icon { font-size: 3rem; color: var(--accent); }

        /* --- FORMS --- */
        .form-container {
            max-width: 500px;
            margin: 40px auto;
            background: var(--bg-card);
            padding: 40px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            text-align: center;
        }
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--accent);
            font-size:  0.9rem;
        }
        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: inherit;
            color: var(--text-main);
            background-color: var(--input-bg);
        }
        .form-group input:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(240, 148, 16, 0.2);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        .checkbox-group input {
            width: auto;
            cursor: pointer;
        }

        /* --- DASHBOARDS --- */
        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        /* Status Badges */
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
        }
        .badge-unseen { background-color: var(--accent); color: #000; }
        .badge-unreviewed { background-color: var(--primary); color: #fff; }
        .badge-reviewed { background-color: #28a745; color: white; }

        /* Project List */
        .project-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .project-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            gap: 15px;
        }
        .project-info h4 { margin-bottom: 5px; font-size: 1.1rem; }
        .project-meta { font-size: 0.85rem; opacity: 0.8; }
        .project-actions {
            display: flex;
            gap: 10px;
        }
        .grade-text {
            color: var(--accent);
            font-weight: 700;
            font-size: 0.95rem;
            margin-top: 5px;
            display: block;
        }

        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: var(--accent);
            color: #000;
            text-align: center;
            border-radius: 4px;
            padding: 16px;
            position: fixed;
            z-index: 2000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            font-weight: 700;
        }
        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 10px; }
            .logo-img { height: 50px; }
            .project-item { flex-direction: column; text-align: left; align-items: flex-start; }
            .project-actions { width: 100%; justify-content: flex-end; margin-top: 10px; }
            .btn { width: 100%; margin-bottom: 5px; }
            .project-actions .btn { width: auto; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo-area">
                <img src="https://z-cdn-media.chatglm.cn/files/dcad322b-5c51-420d-a93e-d5b12a509c5e.png?auth_key=1868671749-6662dee5b06245eba1477903d4eab1d3-0-7da897331e5dcdb4c77094799aa8a5fd" alt="Jabalpur Engineering College Logo" class="logo-img">
            </div>
            
            <div class="header-title">
                <h1>JEC Project Management</h1>
                <span>Centralized Tracking & Evaluation</span>
            </div>

            <button class="theme-toggle" id="themeBtn" onclick="toggleTheme()">üåô Dark Mode</button>
        </div>
    </header>

    <main class="container">
        
        <!-- View 1: Landing Page -->
        <section id="landing-view" class="view-section">
            <div style="margin-bottom: 20px;">
                <h2 style="font-size: 2rem; margin-bottom: 10px;">Welcome to JEC Projects</h2>
                <p>Manage Major & Minor Projects seamlessly.</p>
            </div>
            
            <div class="role-cards">
                <div class="card" onclick="showLogin('student')">
                    <div class="card-icon">üéì</div>
                    <h3>Student Login</h3>
                    <p>Submit projects, track progress, and view history.</p>
                </div>
                
                <div class="card" onclick="showLogin('faculty')">
                    <div class="card-icon">üë®‚Äçüè´</div>
                    <h3>Faculty Login</h3>
                    <p>Review submissions, allocate mentors, and evaluate.</p>
                </div>

                <div class="card" onclick="window.open('https://www.jecjabalpur.ac.in/', '_blank')">
                    <div class="card-icon">üåç</div>
                    <h3>JEC Official Website</h3>
                    <p>Visit Jabalpur Engineering College Website.</p>
                </div>
            </div>
        </section>

        <!-- View 2: Login Form -->
        <section id="login-view" class="view-section hidden">
            <div class="form-container">
                <h2 id="login-title" style="margin-bottom: 20px;">Login</h2>
                <div class="form-group">
                    <label id="login-label-id">User ID</label>
                    <input type="text" id="login-id" placeholder="Enter ID..." required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-pass" placeholder="Enter Password" required>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="handleLogin()">Login</button>
                <div style="margin-top: 15px; font-size: 0.8rem; background: rgba(0,0,0,0.05); padding: 10px; border-radius: 4px;">
                    <strong>Demo Credentials:</strong><br>
                    <span id="demo-creds-text">Student: <strong>0201AI251099</strong> / 123456<br>
                    Faculty: <strong>TEACHER1</strong> / 123456</span>
                </div>
                <button class="btn" style="margin-top: 15px; border: none; text-decoration: underline;" onclick="showView('landing-view')">Back to Home</button>
            </div>
        </section>

        <!-- View 3: Student Dashboard -->
        <section id="student-dashboard" class="view-section hidden">
            <div class="dashboard-header">
                <h2 id="student-welcome">Welcome Student</h2>
                <p>Manage your academic projects.</p>
            </div>

            <div class="dashboard-grid">
                <div class="card" onclick="showView('submit-project-view')">
                    <div class="card-icon">üì§</div>
                    <h3>Submit Project</h3>
                    <p>Upload a new proposal.</p>
                </div>
                <div class="card" onclick="prepareEditView()">
                    <div class="card-icon">‚úèÔ∏è</div>
                    <h3>Edit Project</h3>
                    <p>Modify existing submissions.</p>
                </div>
                <div class="card" onclick="renderStudentHistory(); showView('history-view')">
                    <div class="card-icon">üìö</div>
                    <h3>History</h3>
                    <p>View all submissions.</p>
                </div>
                <div class="card" onclick="renderStudentProgress(); showView('progress-view')">
                    <div class="card-icon">üìä</div>
                    <h3>Status</h3>
                    <p>Check review status and grades.</p>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn" onclick="logout()">Logout</button>
            </div>
        </section>

        <!-- View 4: Submit Project Form -->
        <section id="submit-project-view" class="view-section hidden">
            <div class="form-container" style="max-width: 600px;">
                <h2>Submit New Project</h2>
                <div class="form-group">
                    <label>Project Title</label>
                    <input type="text" id="proj-title" placeholder="e.g. AI Traffic Control" required>
                </div>
                <div class="form-group">
                    <label>Description / Abstract</label>
                    <textarea id="proj-desc" rows="4" placeholder="Brief overview..." required></textarea>
                </div>
                <div class="form-group">
                    <label>Upload PDF (Report)</label>
                    <input type="file" id="proj-pdf" accept=".pdf">
                    <small style="opacity:0.7;">Simulation only (file is not actually uploaded).</small>
                </div>
                <div class="form-group">
                    <label>Video Link (YouTube/Drive)</label>
                    <input type="text" id="proj-video" placeholder="https://youtube.com/...">
                </div>
                <button class="btn btn-primary" onclick="submitProject()">Submit</button>
                <button class="btn" onclick="showView('student-dashboard')">Cancel</button>
            </div>
        </section>

        <!-- View 5: Edit Project (Search -> Form) -->
        <section id="edit-project-search" class="view-section hidden">
            <div class="form-container">
                <h2>Edit Project</h2>
                <p>Enter your Project ID to continue.</p>
                <div class="form-group">
                    <label>Project ID</label>
                    <input type="text" id="edit-search-id" placeholder="e.g. PROJ-1234" required>
                </div>
                <button class="btn btn-primary" onclick="searchProject()">Find Project</button>
                <button class="btn" onclick="showView('student-dashboard')">Back</button>
            </div>
        </section>

        <section id="edit-project-form" class="view-section hidden">
            <div class="form-container" style="max-width: 600px;">
                <h2>Edit: <span id="edit-id-display" style="font-size:0.9rem; color:var(--accent)"></span></h2>
                <input type="hidden" id="edit-orig-id">
                
                <div class="form-group">
                    <label>Project Title</label>
                    <input type="text" id="edit-title" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="edit-desc" rows="4" required></textarea>
                </div>
                
                <!-- File Management -->
                <div class="form-group" style="background: rgba(0,0,0,0.05); padding: 15px; border-radius: 8px;">
                    <label style="margin-bottom:10px;">File Management</label>
                    <div id="edit-file-status" style="font-size:0.9rem; margin-bottom:10px;"></div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="edit-remove-pdf"> 
                        <label for="edit-remove-pdf" style="margin:0; font-weight:400;">Remove Current PDF</label>
                    </div>
                    
                    <div id="new-pdf-upload" class="hidden" style="margin-top:10px;">
                        <label>Upload New PDF</label>
                        <input type="file" id="edit-new-pdf" accept=".pdf">
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="edit-remove-video"> 
                        <label for="edit-remove-video" style="margin:0; font-weight:400;">Remove Video Link</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Update Video Link</label>
                    <input type="text" id="edit-video" placeholder="New link...">
                </div>
                
                <button class="btn btn-primary" onclick="saveEditedProject()">Save Changes</button>
                <button class="btn" onclick="showView('student-dashboard')">Cancel</button>
            </div>
        </section>

        <!-- View 6: History & Progress -->
        <section id="history-view" class="view-section hidden">
            <div class="dashboard-header">
                <h2>Project History</h2>
                <p>Record of all submissions.</p>
            </div>
            <div id="student-history-list" class="project-list"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showView('student-dashboard')">Back to Dashboard</button>
            </div>
        </section>

        <section id="progress-view" class="view-section hidden">
            <div class="dashboard-header">
                <h2>Project Status</h2>
                <p>Review status, grades, and feedback.</p>
            </div>
            <div id="student-progress-list" class="project-list"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showView('student-dashboard')">Back to Dashboard</button>
            </div>
        </section>

        <!-- View 7: Faculty Dashboard -->
        <section id="faculty-dashboard" class="view-section hidden">
            <div class="dashboard-header">
                <!-- DYNAMIC HEADING FOR FACULTY -->
                <h2 id="faculty-header-text">Faculty Dashboard</h2>
                <p>Review Queue</p>
            </div>

            <div class="dashboard-grid">
                <div class="card" onclick="filterFacultyProjects('New')">
                    <div class="card-icon">üÜï</div>
                    <h3>New</h3>
                    <p id="count-new">0</p>
                </div>
                <div class="card" onclick="filterFacultyProjects('Unreviewed')">
                    <div class="card-icon">‚è≥</div>
                    <h3>Unreviewed</h3>
                    <p id="count-unreviewed">0</p>
                </div>
                <div class="card" onclick="filterFacultyProjects('Reviewed')">
                    <div class="card-icon">‚úÖ</div>
                    <h3>Reviewed</h3>
                    <p id="count-reviewed">0</p>
                </div>
            </div>

            <h3 style="margin-bottom: 20px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; font-size: 1.1rem;">
                List: <span id="current-faculty-filter" style="color:var(--accent)">All</span>
            </h3>
            <div id="faculty-project-list" class="project-list"></div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="logout()">Logout</button>
            </div>
        </section>

        <!-- Faculty Review Modal (View) -->
        <section id="faculty-review-view" class="view-section hidden">
            <div class="form-container" style="max-width: 700px;">
                <h2>Evaluate: <span id="review-proj-id" style="font-size: 0.9rem; color: var(--accent);"></span></h2>
                
                <!-- Project Preview -->
                <div style="background: rgba(0,0,0,0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left; border-left: 4px solid var(--accent);">
                    <p><strong>Title:</strong> <span id="review-title"></span></p>
                    <p><strong>Student:</strong> <span id="review-student"></span></p>
                    <div style="margin-top: 10px;">
                        <strong>Attachments:</strong><br>
                        <span id="review-files"></span>
                        <button id="btn-dl-sim" class="btn" style="font-size: 0.7rem; padding: 2px 8px; margin-left: 10px; display: none;" onclick="showToast('Downloading PDF...')">Download</button>
                        <br>
                        <span id="review-link"></span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Update Status</label>
                    <select id="review-status">
                        <option value="New">New</option>
                        <option value="Unreviewed">Unreviewed</option>
                        <option value="Reviewed">Reviewed</option>
                    </select>
                </div>
                
                <!-- Grading Input -->
                <div class="form-group">
                    <label>Grade (Mark out of 10)</label>
                    <select id="review-grade">
                        <option value="">-- Select Grade --</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Feedback / Comments</label>
                    <textarea id="review-comments" rows="4" placeholder="Enter evaluation comments here..."></textarea>
                </div>
                
                <button class="btn btn-primary" onclick="submitReview()">Submit Evaluation</button>
                <button class="btn" onclick="showView('faculty-dashboard')">Cancel</button>
            </div>
        </section>

    </main>

    <!-- Toast Component -->
    <div id="toast">Message Here</div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA & STATE MANAGEMENT ---
        
        const USERS = [
            { id: '0201AI251099', pass: '123456', role: 'student', name: 'MOHIT SHARMA' },
            { id: 'TEACHER1', pass: '123456', role: 'faculty', name: 'Prof. RAJIV DIXIT' }
        ];

        let currentUser = null;
        
        // --- HELPER: GENERATE ARMY IDS ---
        // Generates 0201AI2510XX where XX is random 10-99
        const generateArmyId = () => '0201AI2510' + Math.floor(Math.random() * 90 + 10);

        // --- HELPER: CREATE PROJECT ---
        const createProject = (title, desc, name, id, status, grade = null, comments = '') => ({
            id: id,
            studentId: id,
            studentName: name,
            title: title,
            description: desc,
            pdf: 'report.pdf',
            video: 'https://www.youtube.com/watch?v=jfKfPfyJRdk',
            status: status,
            grade: grade,
            comments: comments,
            date: '15/01/2026'
        });

        // --- HARD RESET & SEED ---
        // We force a reset to ensure new data appears
        localStorage.removeItem('jec_projects');
        let projects = [];

        // 1. IoT Team Project (Unreviewed) - NAMES UPDATED
        projects.push(createProject(
            'IoT Home Automation',
            'Controlling home appliances remotely via a mobile app and ESP8266 module.',
            'MOHIT SHARMA, HARBAJAN SINGH, SANTOSH MAHADIK', 
            '0201AI251099',
            'Unreviewed'
        ));

        // 2. Blockchain Voting (Reviewed)
        projects.push(createProject(
            'Blockchain Voting System',
            'A decentralized voting application ensuring transparency and security.',
            'MOHIT SHARMA',
            '0201AI251099',
            'Reviewed',
            9,
            'Great concept. Solid implementation of smart contracts.'
        ));

        // 3. Solar Tracker (Unreviewed)
        projects.push(createProject(
            'Solar Tracker System',
            'Hardware implementation of dual axis solar tracker using LDR sensors for maximum efficiency.',
            'MOHIT SHARMA',
            '0201AI251099',
            'Unreviewed'
        ));

        // --- ADD 4 PROJECTS TO "NEW" SECTION (Army Personnel - FULL NAMES, NO RANKS) ---
        // Using names: Abhay Sapru, Rajeev Bharwan, Vikram Singh, Vijay Singh
        projects.push(createProject(
            'Drone Surveillance System',
            'Autonomous drone patrolling for border security using AI.',
            'Abhay Sapru', 
            generateArmyId(),
            'New'
        ));

        projects.push(createProject(
            'Cyber Security Audit',
            'Vulnerability assessment and patch management for military networks.',
            'Rajeev Bharwan', 
            generateArmyId(),
            'New'
        ));

        projects.push(createProject(
            'AI Chatbot for Recruitment',
            'Automating query responses for aspiring candidates.',
            'Vikram Singh',
            generateArmyId(),
            'New'
        ));

        projects.push(createProject(
            'Supply Chain Blockchain',
            'Tracking logistics and inventory using decentralized ledger.',
            'Vijay Singh',
            generateArmyId(),
            'New'
        ));

        // --- ADD 4 PROJECTS TO "UNREVIEWED" SECTION (Army Personnel - FULL NAMES, NO RANKS) ---
        // Using names: Ravi Sharma, Naveen Kumar, Suresh Pathak, Gaurav Arora
        projects.push(createProject(
            'Smart Agriculture Monitoring',
            'IoT sensors for crop health and automated irrigation.',
            'Ravi Sharma',
            generateArmyId(),
            'Unreviewed'
        ));

        projects.push(createProject(
            'Hospital Management System',
            'Digitizing patient records and doctor schedules.',
            'Naveen Kumar',
            generateArmyId(),
            'Unreviewed'
        ));

        projects.push(createProject(
            'Traffic Sign Recognition',
            'Computer vision based traffic sign detection for autonomous vehicles.',
            'Suresh Pathak',
            generateArmyId(),
            'Unreviewed'
        ));

        projects.push(createProject(
            'Cloud Computing Architecture',
            'Secure cloud infrastructure for defense data storage.',
            'Gaurav Arora',
            generateArmyId(),
            'Unreviewed'
        ));

        // Save Initial Data
        localStorage.setItem('jec_projects', JSON.stringify(projects));

        function saveProjects() {
            localStorage.setItem('jec_projects', JSON.stringify(projects));
        }

        // --- NAVIGATION & UI ---

        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function showToast(message) {
            const x = document.getElementById("toast");
            x.innerText = message;
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }

        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('themeBtn');
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                btn.innerText = "üåô Dark Mode";
            } else {
                body.setAttribute('data-theme', 'dark');
                btn.innerText = "‚òÄÔ∏è Light Mode";
            }
        }

        // --- AUTHENTICATION ---

        let selectedRole = '';

        function showLogin(role) {
            selectedRole = role;
            const title = role === 'student' ? 'Student Login' : 'Faculty Login';
            document.getElementById('login-title').innerText = title;
            
            // Update UI for Faculty Login
            if (role === 'faculty') {
                document.getElementById('login-label-id').innerText = "Teacher ID";
                document.getElementById('login-id').placeholder = "Enter Teacher ID (TEACHER1)";
                const credsText = document.getElementById('demo-creds-text');
                credsText.innerHTML = '<strong>Demo Credentials:</strong><br>Faculty: <strong>TEACHER1</strong> / 123456';
            } else {
                document.getElementById('login-label-id').innerText = "User ID";
                document.getElementById('login-id').placeholder = "Enter ID (e.g. 0201AI251099)";
                const credsText = document.getElementById('demo-creds-text');
                credsText.innerHTML = '<strong>Demo Credentials:</strong><br>Student: <strong>0201AI251099</strong> / 123456';
            }
            
            showView('login-view');
        }

        function handleLogin() {
            const id = document.getElementById('login-id').value.trim();
            const pass = document.getElementById('login-pass').value.trim();

            if (!id || !pass) {
                showToast("Please enter ID and Password.");
                return;
            }

            const user = USERS.find(u => u.id === id && u.pass === pass);

            if (user) {
                if (user.role !== selectedRole) {
                    showToast("Invalid role selected for this ID.");
                    return;
                }
                currentUser = user;
                document.getElementById('login-id').value = '';
                document.getElementById('login-pass').value = '';
                
                if (user.role === 'student') {
                    document.getElementById('student-welcome').innerText = `Welcome, ${user.name}`;
                    showView('student-dashboard');
                } else {
                    // If Faculty, update header name
                    const headerEl = document.getElementById('faculty-header-text');
                    if(headerEl) headerEl.innerText = "Welcome Prof. RAJIV DIXIT";
                    
                    updateFacultyCounts();
                    showView('faculty-dashboard');
                }
                showToast(`Login Successful!`);
            } else {
                showToast("Invalid Credentials.");
            }
        }

        function logout() {
            currentUser = null;
            showView('landing-view');
            showToast("Logged out.");
        }

        // --- STUDENT FUNCTIONS ---

        function submitProject() {
            const title = document.getElementById('proj-title').value.trim();
            const desc = document.getElementById('proj-desc').value.trim();
            const pdfInput = document.getElementById('proj-pdf');
            const video = document.getElementById('proj-video').value.trim();

            if (!title || !desc) {
                showToast("Title and Description are required.");
                return;
            }

            const newProject = {
                id: 'PROJ-' + Math.floor(Math.random() * 10000),
                studentId: currentUser.id,
                studentName: currentUser.name,
                title: title,
                description: desc,
                pdf: pdfInput.files.length > 0 ? pdfInput.files[0].name : null,
                video: video,
                status: 'New',
                grade: null,
                comments: '',
                date: '15/01/2026'
            };

            projects.push(newProject);
            saveProjects();
            
            showToast(`Submitted! ID: ${newProject.id}`);
            
            document.getElementById('proj-title').value = '';
            document.getElementById('proj-desc').value = '';
            document.getElementById('proj-pdf').value = '';
            document.getElementById('proj-video').value = '';

            showView('student-dashboard');
        }

        function renderStudentHistory() {
            const list = document.getElementById('student-history-list');
            list.innerHTML = '';
            const myProjects = projects.filter(p => p.studentId === currentUser.id);

            if (myProjects.length === 0) {
                list.innerHTML = '<p style="text-align:center; opacity:0.7;">No projects found for your account.</p>';
                return;
            }

            myProjects.forEach(p => {
                let badgeClass = p.status === 'Reviewed' ? 'badge-reviewed' : (p.status === 'New' ? 'badge-unseen' : 'badge-unreviewed');
                const html = `
                <div class="project-item">
                    <div class="project-info">
                        <h4>${p.title} <span class="badge ${badgeClass}">${p.status}</span></h4>
                        <div class="project-meta">ID: ${p.id} | ${p.date}</div>
                        <div style="margin-top:5px; font-size:0.85rem;">
                            ${p.pdf ? 'üìÑ PDF' : ''} ${p.video ? 'üé• Video' : ''}
                        </div>
                    </div>
                </div>`;
                list.innerHTML += html;
            });
        }

        function renderStudentProgress() {
            const list = document.getElementById('student-progress-list');
            list.innerHTML = '';
            const myProjects = projects.filter(p => p.studentId === currentUser.id);

            if (myProjects.length === 0) {
                list.innerHTML = '<p style="text-align:center; opacity:0.7;">No projects to track.</p>';
                return;
            }

            myProjects.forEach(p => {
                let badgeClass = p.status === 'Reviewed' ? 'badge-reviewed' : (p.status === 'New' ? 'badge-unseen' : 'badge-unreviewed');
                let displayStatus = p.status === 'New' ? 'Unseen' : p.status;

                let gradeDisplay = '';
                if (p.status === 'Reviewed' && p.grade !== null) {
                    gradeDisplay = `<div class="grade-text">üèÜ Grade: ${p.grade}/10</div>`;
                }

                const html = `
                <div class="project-item">
                    <div class="project-info" style="width:100%">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h4>${p.title}</h4>
                            <span class="badge ${badgeClass}">${displayStatus}</span>
                        </div>
                        ${gradeDisplay}
                        ${p.comments ? `<div style="margin-top:10px; padding:10px; background:rgba(0,0,0,0.05); border-radius:4px; font-style:italic;">üí¨ Feedback: ${p.comments}</div>` : ''}
                    </div>
                </div>`;
                list.innerHTML += html;
            });
        }

        // --- EDIT PROJECT LOGIC ---

        function prepareEditView() {
            showView('edit-project-search');
            document.getElementById('edit-search-id').value = '';
        }

        function searchProject() {
            const searchId = document.getElementById('edit-search-id').value.trim();
            const project = projects.find(p => p.id === searchId && p.studentId === currentUser.id);

            if (project) {
                document.getElementById('edit-orig-id').value = project.id;
                document.getElementById('edit-id-display').innerText = project.id;
                document.getElementById('edit-title').value = project.title;
                document.getElementById('edit-desc').value = project.description;
                document.getElementById('edit-video').value = project.video || '';
                
                document.getElementById('edit-remove-pdf').checked = false;
                document.getElementById('edit-remove-video').checked = false;
                document.getElementById('edit-new-pdf').value = '';
                document.getElementById('new-pdf-upload').classList.add('hidden');
                
                const fileStatus = document.getElementById('edit-file-status');
                fileStatus.innerHTML = `Current PDF: <strong>${project.pdf ? project.pdf : 'None'}</strong>`;

                showView('edit-project-form');
            } else {
                showToast("Project ID not found or access denied.");
            }
        }

        document.getElementById('edit-remove-pdf').addEventListener('change', function() {
            const uploadDiv = document.getElementById('new-pdf-upload');
            if(this.checked) {
                uploadDiv.classList.remove('hidden');
            } else {
                uploadDiv.classList.add('hidden');
            }
        });

        function saveEditedProject() {
            const id = document.getElementById('edit-orig-id').value;
            const title = document.getElementById('edit-title').value.trim();
            const desc = document.getElementById('edit-desc').value.trim();
            const video = document.getElementById('edit-video').value.trim();
            const removePdf = document.getElementById('edit-remove-pdf').checked;
            const removeVideo = document.getElementById('edit-remove-video').checked;
            const newPdfInput = document.getElementById('edit-new-pdf');

            const projectIndex = projects.findIndex(p => p.id === id);
            if (projectIndex > -1) {
                projects[projectIndex].title = title;
                projects[projectIndex].description = desc;
                
                if (removePdf) {
                    if (newPdfInput.files.length > 0) {
                        projects[projectIndex].pdf = newPdfInput.files[0].name;
                    } else {
                        projects[projectIndex].pdf = null;
                    }
                }

                if (removeVideo) {
                    projects[projectIndex].video = '';
                } else if (video) {
                    projects[projectIndex].video = video;
                }

                saveProjects();
                showToast("Project updated successfully!");
                showView('student-dashboard');
            } else {
                showToast("Error updating project.");
            }
        }

        // --- FACULTY FUNCTIONS ---

        function updateFacultyCounts() {
            const counts = { 'New': 0, 'Unreviewed': 0, 'Reviewed': 0 };
            projects.forEach(p => {
                if (counts[p.status] !== undefined) counts[p.status]++;
            });
            document.getElementById('count-new').innerText = counts['New'];
            document.getElementById('count-unreviewed').innerText = counts['Unreviewed'];
            document.getElementById('count-reviewed').innerText = counts['Reviewed'];
        }

        function filterFacultyProjects(filter) {
            document.getElementById('current-faculty-filter').innerText = filter;
            const list = document.getElementById('faculty-project-list');
            list.innerHTML = '';

            // REQUEST: "every student submit reports to her so only shown all the projects to her."
            // CHANGED: Removed filtering by student ID. Now shows ALL projects with given status.
            
            // Logic: If Faculty (TEACHER1) is logged in, show 'TEACHER1' as the ID for ALL projects.
            // Otherwise (e.g. Admin/Observer), show the actual Student IDs.
            const displayId = (currentUser.id === 'TEACHER1') ? 'TEACHER1' : p.studentId;

            const filtered = projects.filter(p => p.status === filter);

            if (filtered.length === 0) {
                list.innerHTML = `<div style="text-align:center; padding:20px; opacity:0.7;">No ${filter.toLowerCase()} projects.</div>`;
                return;
            }

            filtered.forEach(p => {
                const actionHtml = (p.status === 'Reviewed') 
                    ? `<span style="font-size:0.8rem; opacity:0.6; font-weight:600;">COMPLETED</span>` 
                    : `<button class="btn btn-primary" onclick="openReview('${p.id}')">Review</button>`;

                const html = `
                <div class="project-item">
                    <div class="project-info">
                        <h4>${p.title}</h4>
                        <div class="project-meta">
                            ${p.studentName} (${displayId})<br>
                            <span style="font-size:0.8rem">${p.date}</span>
                        </div>
                    </div>
                    <div class="project-actions">
                        ${actionHtml}
                    </div>
                </div>`;
                list.innerHTML += html;
            });
        }

        let currentReviewId = null;

        function openReview(id) {
            const project = projects.find(p => p.id === id);
            if (!project) return;

            // REQUEST: "whenever teacher opens a project in new projects section... put it in unreviewed section just after that"
            if (project.status === 'New') {
                project.status = 'Unreviewed';
                saveProjects();
                updateFacultyCounts();
                // We don't switch view immediately because the user is in the "Review" modal.
                // But when they go back, it will be in Unreviewed.
                showToast("Project moved to Unreviewed");
            }

            currentReviewId = id;
            document.getElementById('review-proj-id').innerText = project.id;
            document.getElementById('review-title').innerText = project.title;
            document.getElementById('review-student').innerText = project.studentName;
            
            const fileSpan = document.getElementById('review-files');
            const btnDl = document.getElementById('btn-dl-sim');
            const linkSpan = document.getElementById('review-link');
            
            if (project.pdf) {
                fileSpan.innerText = `üìÑ ${project.pdf}`;
                btnDl.style.display = 'inline-block';
            } else {
                fileSpan.innerText = 'No PDF attached';
                btnDl.style.display = 'none';
            }

            if (project.video) {
                linkSpan.innerHTML = `<br><a href="${project.video}" target="_blank" style="color:var(--accent)">üé• Open Video Link</a>`;
            } else {
                linkSpan.innerHTML = '';
            }

            document.getElementById('review-status').value = project.status;
            document.getElementById('review-comments').value = project.comments || '';
            document.getElementById('review-grade').value = project.grade || "";

            showView('faculty-review-view');
        }

        function submitReview() {
            // Force status to Reviewed
            const newComments = document.getElementById('review-comments').value.trim();
            const newGrade = document.getElementById('review-grade').value;

            const index = projects.findIndex(p => p.id === currentReviewId);
            if (index > -1) {
                projects[index].status = 'Reviewed'; 
                projects[index].comments = newComments;
                
                if (newGrade !== "") {
                    projects[index].grade = newGrade;
                }

                saveProjects();
                
                showToast("Evaluation Submitted! Project Moved to Reviewed.");
                showView('faculty-dashboard');
                updateFacultyCounts();
                filterFacultyProjects('Reviewed'); 
            }
        }

        updateFacultyCounts();
    </script>
</body>
</html>